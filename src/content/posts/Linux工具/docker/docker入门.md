---
title: dockerå…¥é—¨
description: ""
image: ""
published: 2025-01-28
tags:
  - docker
category: Linuxå·¥å…·
draft: false
---

# ä¸ºä»€ä¹ˆè¦ç”¨ Docker

è½¯ä»¶å¼€å‘æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•é…ç½®ç¯å¢ƒ,æ¯”å¦‚ä¸€ä¸ª python åº”ç”¨,å¿…é¡»è¦ python,è¿˜æœ‰ä¾èµ–,æœ‰æ—¶å€™è¿˜æœ‰ç¯å¢ƒå˜é‡.ä»£ç èƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè·‘,åœ¨å…¶ä»–æœºå™¨ä¸Šå¯èƒ½è·‘ä¸äº†.

docker æ˜¯ linux å®¹å™¨çš„ä¸€ç§å°è£…,æä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨æ¥å£,æŠŠåº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–æ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­, è¿è¡Œè¿™ä¸ªæ–‡ä»¶,å°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨,ç¨‹åºåœ¨è¿™ä¸ªå®¹å™¨é‡Œè¿è¡Œ,å°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œ.

docker èƒ½å¤Ÿ

1. æä¾›ä¸€æ¬¡æ€§çš„ç¯å¢ƒ
2. æä¾›å¼¹æ€§çš„äº‘æœåŠ¡.docker å¯ä»¥éšæ—¶å¼€å…³,é€‚åˆè¿ç»´å’Œç¼©å®¹.
3. ç»„ä»¶å¾®æœåŠ¡æ¶æ„.é€šè¿‡å¤šä¸ªå®¹å™¨,å¯ä»¥åœ¨æœ¬æœºæ¨¡æ‹Ÿä¸ºæœåŠ¡æ¶æ„.

# åˆ›å»ºä¸€ä¸ªåŸºæœ¬é•œåƒ

docker æŠŠåº”ç”¨ç¨‹åºå’Œä¾èµ–æ‰“åŒ…åœ¨ image æ–‡ä»¶é‡Œé¢,åªæœ‰é€šè¿‡è¿™ä¸ªæ–‡ä»¶,æ‰èƒ½ç”Ÿæˆ docker å®¹å™¨,image æ–‡ä»¶å¯ä»¥çœ‹åšæ˜¯å®¹å™¨çš„æ¨¡ç‰ˆ.docker ä¼šæ ¹æ® image æ–‡ä»¶ç”Ÿæˆå®¹å™¨çš„å®ä¾‹,åŒä¸€ä¸ª image æ–‡ä»¶èƒ½å¤Ÿç”Ÿæˆå¤šä¸ªå®ä¾‹.

image æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶,å®é™…å¼€å‘ä¸­,ä¸€ä¸ª image æ–‡ä»¶å¾€å¾€ç»§æ‰¿å¦ä¸€ä¸ª image æ–‡ä»¶,åŠ ä¸Šä¸€äº›ä¸ªæ€§åŒ–è®¾ç½®è€Œæˆ,æ¯”å¦‚å¯ä»¥åœ¨ ubuntu çš„ image ä¸ŠåŠ å…¥ apache æœåŠ¡å™¨.ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨åˆ«äººçš„ image ä¸ŠåŠ ä¸€äº›è‡ªå·±çš„å®šåˆ¶,è€Œä¸æ˜¯å…¨éƒ¨è‡ªå·±åˆ¶ä½œ,ä¸ºäº†æ–¹ä¾¿å…±äº«,æˆ‘ä»¬å¯ä»¥æŠŠ image æ–‡ä»¶å‘å¸ƒåˆ°ç½‘ä¸Šçš„ä»“åº“.

## Docker é•œåƒ

ä½¿ç”¨ `docker search keyword` æœç´¢é•œåƒ

ä½¿ç”¨ `docker images` æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„æ–‡ä»¶

ä½¿ç”¨ `docker pull [IMAGE_NAME]:[TAG]` æ‹‰å–é•œåƒ,é»˜è®¤ä½¿ç”¨ latest ç‰ˆæœ¬

ä½¿ç”¨ `docker rmi [image]` åˆ é™¤é•œåƒ

## Docker å®¹å™¨

docker å¯åŠ¨å®¹å™¨æœ‰ä¸¤ç§æ–¹å¼,

1. åŸºäºé•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨
2. å°†ä¸€ä¸ªç»ˆæ­¢çš„å®¹å™¨å¯åŠ¨

### åŸºäºé•œåƒæ–°å»ºå®¹å™¨å¹¶å¯åŠ¨

`docker run IMAGE:TAG`,ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼Œæ¯”å¦‚æƒ³å¯åŠ¨ä¸€ä¸ªÂ `ubuntu`Â å®¹å™¨, å¹¶é€šè¿‡ç»ˆç«¯è¾“å‡ºÂ `Hello world`ï¼š`docker run ubuntu:latest /bin/echo 'Hello world'`

è¿™ä¸ªå‘½ä»¤åœ¨è¾“å‡ºå®Œåå°±ä¼šåœæ­¢,å¦‚æœæƒ³è¦äº¤äº’çš„è¿è¡Œå®¹å™¨,éœ€è¦æ‰§è¡Œ `docker run -t -i ubuntu:latest /bin/bash`,è¿™é‡Œçš„ -t æ˜¯ docker åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯,-i æ˜¯è®©å®¹å™¨ä¿æŒæ‰“å¼€

åœ¨å®é™…ä½¿ç”¨ä¸­,éœ€è¦è®©å®¹å™¨ä»¥åå°çš„æ–¹å¼è¿è¡Œ,è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦æ·»åŠ  `-d` å‚æ•°æ¥ä¿æŒå®¹å™¨çš„è¿è¡Œ.åå°è¿è¡Œçš„å®¹å™¨å¯ä»¥ä½¿ç”¨ `docker logs` æ¥æŸ¥çœ‹æ—¥å¿—

### æŸ¥çœ‹å®¹å™¨

image ç”Ÿæˆçš„å®¹å™¨å®ä¾‹æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶,è¢«ç§°ä¸ºå®¹å™¨æ–‡ä»¶,ä¹Ÿå°±æ˜¯è¯´å®¹å™¨ä¸€æ—¦è¿è¡Œå°±ä¼šå­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ image å’Œå®¹å™¨æ–‡ä»¶.å…³é—­å®¹å™¨å¹¶ä¸ä¼šåˆ é™¤å®¹å™¨æ–‡ä»¶,åªæ˜¯è®©å®¹å™¨åœæ­¢è¿è¡Œ.å¯ä»¥ä½¿ç”¨ `docker ps -a` æ¥æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨.æƒ³è¦åˆ é™¤å®¹å™¨æ–‡ä»¶å¯ä»¥ä½¿ç”¨ `docker rm [containerID]` æ¥åˆ é™¤æŒ‡å®šçš„å®¹å™¨

### è¿›å…¥å®¹å™¨

docker å¯ä»¥ä½¿ç”¨ exec å‘½ä»¤è¿›å…¥å®¹å™¨,æ¯”å¦‚ `docker exec -it [name] /bin/bash`,è¿™é‡Œé€€å‡ºå®¹å™¨çš„æ—¶å€™å®¹å™¨ä¸ä¼šåœæ­¢

### å¯¼å‡ºå®¹å™¨

å¯ä»¥ä½¿ç”¨ `docker export` å¯¼å‡ºå®¹å™¨,æ¯”å¦‚ `docker export 9e8d11aeef0c > redis.tar`,ç„¶åä½¿ç”¨ `docker import` å¯ä»¥å°†å¿«ç…§å¯¼å…¥ä¸ºæ–°çš„å®¹å™¨.`cat redis.tar | docker import - test/redis:v1.0`

### æ¸…é™¤å®¹å™¨

ä½¿ç”¨ `docker rm [id/name]` å¯ä»¥åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨,ä½¿ç”¨ `-f` å¯ä»¥å¼ºåˆ¶åˆ é™¤.

å¦‚æœæƒ³è¦åˆ é™¤æ‰€æœ‰å·²ç»åœæ­¢çš„å®¹å™¨,ç›´æ¥ä½¿ç”¨ `docker container prune` å³å¯

# æ•°æ®ç®¡ç†

## ä»€ä¹ˆæ˜¯æ•°æ®å·

ç®€å•æ¥è¯´æ•°æ®å·å°±æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•,ç”¨äºæŒä¹…åŒ–æ•°æ®ä»¥åŠå®¹å™¨ä¹‹é—´çš„å…±äº«,ä»–ä»¥æ­£å¸¸çš„ç›®å½•å­˜åœ¨äºå®¿ä¸»æœºä¸Š,å¹¶ä¸”æ•°æ®é›†ä¸ä¼šéšç€å®¹å™¨è¢«åˆ é™¤è€Œè¢«åˆ é™¤.

- æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨ï¼›
- å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼›
- æ›´æ–°æ•°æ®å·ä¸ä¼šå½±å“é•œåƒï¼›
- æ•°æ®å·é»˜è®¤ä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼›

## Volume æ–¹å¼

docker ç®¡ç†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†,é»˜è®¤ä½äº/var/lib/docker/volumes ä¸‹,ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼.

## Dockerfile æ–‡ä»¶

å­¦ä¼šä½¿ç”¨ image æ–‡ä»¶å,å¦‚ä½•ç”Ÿæˆ image æ–‡ä»¶?å¦‚æœæƒ³è¦æ¨å¹¿è‡ªå·±çš„è½¯ä»¶,å°±å¿…é¡»è¦è‡ªå·±åˆ¶ä½œ image æ–‡ä»¶.è¿™å°±éœ€è¦ä½¿ç”¨ dockerfile æ–‡ä»¶,ä»–æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶,ç”¨æ¥é…ç½® image,docker æ ¹æ®è¯¥æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶çš„ image æ–‡ä»¶.

Dockerfile æ˜¯ä¸€ä¸ªè¢«ç”¨æ¥æ„å»º Docker é•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…å«äº†ä¸€è¡Œè¡Œçš„æŒ‡ä»¤ï¼ˆInstructionï¼‰ï¼Œè¿™äº›æŒ‡ä»¤å¯¹åº”ç€ä¿®æ”¹ã€å®‰è£…ã€æ„å»ºã€æ“ä½œçš„å‘½ä»¤ï¼Œæ¯ä¸€è¡ŒæŒ‡ä»¤æ„å»ºä¸€å±‚ï¼ˆlayerï¼‰ï¼Œå±‚å±‚ç´¯ç§¯ï¼Œäºæ˜¯æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„é•œåƒ

åˆ›å»ºä¸€ä¸ªå«åš `Dockerfile` çš„æ–‡ä»¶,å†™å…¥

```dockerfile
FROM nginx
RUN echo 'è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ„å»ºçš„nginxé•œåƒ' > /usr/share/nginx/html/index.html
```

è¿™é‡Œçš„ from æ˜¯å®šåˆ¶æ—¶éœ€è¦çš„åŸºç¡€é•œåƒ,run åé¢æ˜¯æ‰€éœ€è¦çš„å‘½ä»¤

:::warning

**æ³¨æ„**ï¼šDockerfile çš„æŒ‡ä»¤æ¯æ‰§è¡Œä¸€æ¬¡éƒ½ä¼šåœ¨ docker ä¸Šæ–°å»ºä¸€å±‚ã€‚æ‰€ä»¥è¿‡å¤šæ— æ„ä¹‰çš„å±‚ï¼Œä¼šé€ æˆé•œåƒè†¨èƒ€è¿‡å¤§ã€‚ä¾‹å¦‚ï¼š

```dockerfile
FROM centos
RUNÂ yumÂ -yÂ installÂ wget
RUNÂ wgetÂ -OÂ redis.tar.gzÂ "http://download.redis.io/releases/redis-5.0.3.tar.gz"
RUNÂ tarÂ -xvfÂ redis.tar.gz
```

ä»¥ä¸Šæ‰§è¡Œä¼šåˆ›å»º 3 å±‚é•œåƒã€‚å¯ç®€åŒ–ä¸ºä»¥ä¸‹æ ¼å¼ï¼š

```dockerfile
FROM centos
RUNÂ yumÂ -yÂ installÂ wgetÂ \
Â  Â Â &&Â wgetÂ -OÂ redis.tar.gzÂ "http://download.redis.io/releases/redis-5.0.3.tar.gz"Â \
Â  Â Â &&Â tarÂ -xvfÂ redis.tar.gz
```

:::

### æ„å»ºé•œåƒ

åœ¨ dockerfile ç›®å½•ä¸‹æ‰§è¡Œæ„å»ºå¯ä»¥å¾—åˆ°ä¸€ä¸ªé•œåƒ

```bash
docker build -t nginx:v3 .
```

è¿™é‡Œæœ‰ä¸ª `.`,æ˜¯ä¸Šä¸‹æ–‡è·¯å¾„,docker åœ¨æ„å»ºé•œåƒçš„æ—¶å€™,æœ‰æ—¶å€™ä¼šä½¿ç”¨åˆ°æœ¬åœ°çš„æ–‡ä»¶,docker build åœ¨å¾—çŸ¥è¿™ä¸ªè·¯å¾„åä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ã€‚

# Docker Compose

compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨çš„ docker åº”ç”¨ç¨‹åºçš„å·¥å…·,é€šè¿‡ compose,å¯ä»¥ç”¨ yaml æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡,ç„¶åç”¨ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥å¯åŠ¨ yaml ä¸­é…ç½®çš„æ‰€æœ‰æœåŠ¡.

1. ä½¿ç”¨ dockerfile å®šä¹‰ç¯å¢ƒ
2. ä½¿ç”¨ docker-compose.yml å®šä¹‰åº”ç”¨ç¨‹åºçš„æœåŠ¡
3. æœ€åä½¿ç”¨ docker-compose up å‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åº

